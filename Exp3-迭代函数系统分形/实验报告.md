# 迭代函数系统(IFS)分形实验报告

## 实验目的

1. 理解迭代函数系统(IFS)的基本原理和算法
2. 掌握"混沌游戏"随机迭代方法
3. 实现巴恩斯利蕨和概率树的生成
4. 分析不同参数对分形图形的影响

## 实验过程

### 1. 核心算法实现

**IFS参数定义**:
- 巴恩斯利蕨: 4个仿射变换(茎干、小叶片、左右大叶片)
- 概率树: 3个仿射变换(树干、左右分支)

**混沌游戏算法**:
1. 初始化起始点
2. 随机选择变换(按概率)
3. 应用仿射变换生成新点
4. 重复迭代生成点集

### 2. 分形实现

**巴恩斯利蕨参数**:
- 茎干变换: 概率0.01
- 小叶片变换: 概率0.85
- 左右大叶片变换: 各概率0.07

**概率树参数**:
- 树干变换: 概率0.10
- 左右分支变换: 各概率0.45

### 3. 遇到的问题与解决

(请在此描述实现过程中遇到的问题及解决方法)
答：
1. 问题：在初始运行IFS迭代生成点集时，前期生成的点不稳定，会影响最终图形效果。
解决方法：在 run_ifs 函数中设置 num_skip 参数，跳过前 num_skip 个点，避免初始不稳定点对图形的影响 。
 
2. 问题：在绘制图形时，图形的坐标轴显示可能会影响整体视觉效果。
解决方法：在 plot_ifs 函数中，通过 plt.axis('equal') 保证图形纵横比一致，通过 plt.axis('off') 关闭坐标轴显示，提升图形美观度。

## 结果展示

### 1. 巴恩斯利蕨
[插入生成的巴恩斯利蕨分形图]
![image](https://github.com/user-attachments/assets/06b3e352-56ab-4636-9d94-6d6d3286902d)

- 展示不同变换对应的叶片部分
-答： 在代码中， get_fern_params 函数定义了巴恩斯利蕨的IFS参数，其中包含4种变换：
 
- 第一种变换 [0.00, 0.00, 0.00, 0.16, 0.00, 0.00, 0.01] 对应茎干部分。
 
- 第二种变换 [0.85, 0.04, -0.04, 0.85, 0.00, 1.60, 0.85] 对应小叶片部分。
 
- 第三种变换 [0.20, -0.26, 0.23, 0.22, 0.00, 1.60, 0.07] 对应左侧大叶片部分。
 
- 第四种变换 [-0.15, 0.28, 0.26, 0.24, 0.00, 0.44, 0.07] 对应右侧大叶片部分。
 
- 在 run_ifs 函数中，通过 np.random.choice 根据每种变换对应的概率随机选择变换来迭代生成点，最终这些点共同构成巴恩斯利蕨图形，不同变换生成的点分别对应蕨类植物的不同叶片部分。
- 分析概率参数对叶片密度的影响
- 答：从 get_fern_params 函数可知，小叶片对应的变换概率为0.85，是最大的。这意味着在迭代过程中，生成小叶片部分的点的次数相对更多，所以小叶片部分在图形中显示的点更密集，看起来更茂盛；而茎干对应的概率仅为0.01，生成的点少，在图形中显示相对稀疏 。

### 2. 概率树 
[插入生成的概率树分形图]
![image](https://github.com/user-attachments/assets/68e61888-f902-4c76-9433-32216773089c)

- 展示分支结构
- 答：代码中 get_tree_params 函数定义了3种变换，分别对应树干、左分支、右分支。在 run_ifs 函数迭代生成点的过程中，依据不同变换的概率随机选择变换应用到点上，最终形成概率树的分支结构。
- 分析变换参数对树形的影响
-答： 对于概率树的左分支和右分支，在 get_tree_params 函数中定义了其变换参数。其中仿射变换参数 a 、 b 、 c 、 d 决定了分支的旋转、缩放等效果。例如左分支变换 [0.42, -0.42, 0.42, 0.42, 0.00, 0.20, 0.45]  ， a = 0.42 ， b = -0.42 ， c = 0.42 ， d = 0.42  ，这种参数组合使得左分支有一定角度的旋转和缩放，形成向左上方伸展的分支形态；右分支的参数与之类似但 b 、 c 符号相反，形成向右上方伸展的分支形态。如果改变这些参数值，分支的角度、长度、疏密等都会发生变化 。

## 分析与思考

1. **IFS特性分析**
   - 仿射变换参数对图形各部分的影响
   -答： 仿射变换参数 a 、 b 、 c 、 d 、 e 、 f 中， a 、 b 、 c 、 d 决定了图形的旋转、缩放、剪切等线性变换效果， e 、 f 决定了图形的平移效果。以巴恩斯利蕨为例，不同叶片部分的仿射变换参数不同，使得叶片呈现出不同的形状和位置分布 。比如左侧大叶片的 a = 0.20 ， b = -0.26 等参数决定了它独特的倾斜和伸展方向 。
   - 概率参数与图形密度的关系
   - 答：概率参数决定了在IFS迭代过程中，每种变换被选择执行的频率。概率大的变换，在图形中生成的点更多，相应部分就更密集；概率小的变换，生成点少，对应部分就更稀疏。如巴恩斯利蕨中小叶片概率大，密度高；茎干概率小，密度低 。

2. **参数实验**
   - 修改概率参数的效果
   - 答：实验过程：在 get_fern_params 和 get_tree_params 函数中修改概率参数值，然后重新运行代码生成图形。
   - 例如，将巴恩斯利蕨小叶片的概率从0.85降低到0.49，左侧大叶片概率从0.07提高到0.3，右侧大叶片概率从0.07提高到0.2 。
 - 结果分析：小叶片部分在图形中变得稀疏，而左侧和右侧大叶片部分变得更密集，整体图形形态发生明显变化，小叶片不再占据主导视觉地位 。
-效果变为这样：
- ![image](https://github.com/user-attachments/assets/dfaf5b38-848e-4e6b-91b3-bb5e47661edb)
 - 调整变换参数的效果
- 答：实验过程：在 get_fern_params 和 get_tree_params 函数中修改仿射变换参数 a 、 b 、 c 、 d 、 e 、 f 的值，再重新运行代码。比如，将概率树左分支的 a 从0.42改为 
      0.3， b 从 - 0.42改为 - 0.3 。
 
- 结果分析：左分支的角度和长度发生变化，向左上方伸展的程度变小，树形结构整体更加紧凑 。
   -效果变为这样
   - ![image](https://github.com/user-attachments/assets/602609a1-3a50-47bb-b03a-7a56ace75b78)

3. **扩展思考**
   - 如何设计新的IFS规则生成其他分形
   - 答：可以参考巴恩斯利蕨和概率树的IFS规则定义方式，根据想要生成的分形形状特点，设计不同的仿射变换参数和概率参数组合。例如，想要生成类似雪花的分形，可以设计多个围绕中心对称分布的仿射变换，每个变换对应雪花的一个分支，通过调整参数控制分支的形状、长度和角度，同时合理设置概率参数控制各分支的生成频率 。
   - 添加颜色渐变效果的方法
   - 答：可以根据点的生成顺序或者点在图形中的位置来映射颜色渐变。例如，在绘制点集时，根据点的 x 坐标值映射到一个颜色渐变区间， x 坐标小的点用一种颜色， x 坐标大的点用另一种颜色，中间值对应颜色渐变过渡 。可以使用 matplotlib 的 cmap （颜色映射）功能实现，如 plt.scatter(points[:,0], points[:,1], s=1, c=points[:,0], cmap='viridis', alpha=0.75) 
   - 性能优化方案(减少点数同时保持视觉效果)
   -答：可以采用降采样的方法，在生成大量点集后，每隔一定间隔选取一个点进行绘制，而不是绘制所有生成的点。例如，原本生成100000个点，现在每隔10个点选取一个点绘制，这样可以在不明显影响整体视觉效果的前提下，减少绘制点数，提高绘图性能 。
4. **算法比较**
   - IFS与其他分形生成方法的对比
   - 答：
   - 迭代函数系统（IFS）：通过定义一组仿射变换和相应概率，利用随机迭代生成点集来构建分形图形。优点是可以灵活地通过调整参数生成各种复杂且具有自相似性的分形图形；缺点是对于复杂图形，参数调整难度较大，且随机迭代可能导致每次生成图形有一定随机性 。
 
- 递归算法：通过递归调用函数，在不同尺度上重复执行相同的操作生成图形。例如，绘制科赫曲线，通过不断递归细分线段并进行特定角度的弯折。优点是逻辑清晰，对于具有明确递归结构的分形生成比较直观；缺点是对于复杂的分形结构，递归深度可能过大，导致性能问题 。
   - 随机迭代与确定性迭代的差异
   - 答：
   - 随机迭代（如IFS）：每次迭代根据概率随机选择一种变换应用到当前点，生成的图形具有一定随机性和统计意义上的自相似性。不同次运行代码，由于随机选择的差异，生成图形细节可能不同，但整体形态相似 。
 
- 确定性迭代：按照固定顺序或规则依次应用变换，每次运行代码生成的图形是完全相同的。例如，一些基于数学公式的分形生成方法，如曼德勃罗集合，通过固定的迭代公式 z = z**2 + c （ z 、 c 为复数）进行迭代，只要初始条件相同，生成图形就完全一致 。

**注：请在每一部分补充你自己的实验内容、图像、分析和关键代码。**
